C51 COMPILER V9.56.0.0   LCD                                                               10/25/2017 15:09:08 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN .\Out Hex\Lcd.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE Program\Lcd.c BROWSE DEBUG OBJECTEXTEND PRINT(.\Out Hex\Lcd.lst) TABS(2)
                    - OBJECT(.\Out Hex\Lcd.obj)

line level    source

   1          
   2          //     
   3          /***************************************************/
   4          
   5          #include<reg51.h>
   6          #include<absacc.h>
   7          #include<intrins.h>
   8          #include<string.h>
   9          #define uchar unsigned char
  10          #define uint unsigned int
  11          
  12          //引脚连接定义
  13          sbit cs        =P0^0;//片选
  14          sbit reset     =P0^1;//复位
  15          sbit rs        =P0^2;//地址/数据切换
  16          sbit sda       =P1^5;// SDI  MOSI
  17          sbit scl       =P1^7;//时钟
  18          //SDO引脚可以不连接
  19          
  20          uchar bdata bitdata;
  21          sbit bit7=bitdata^7;
  22          sbit bit6=bitdata^6;
  23          sbit bit5=bitdata^5;
  24          sbit bit4=bitdata^4;
  25          sbit bit3=bitdata^3;
  26          sbit bit2=bitdata^2;
  27          sbit bit1=bitdata^1;
  28          sbit bit0=bitdata^0;
  29          
  30          
  31          void  delay(uint t);
  32          
  33          
  34          void delay(uint time)
  35          {
  36   1       uint i,j;
  37   1        for(i=0;i<time;i++)
  38   1         for(j=0;j<2500;j++);
  39   1      }
  40          
  41          void  write_command(uchar c)
  42          {
  43   1        cs=0;
  44   1      
  45   1        rs=0;
  46   1        bitdata=c;
  47   1      
  48   1        sda=bit7;scl=0;scl=1;
  49   1        sda=bit6;scl=0;scl=1;
  50   1        sda=bit5;scl=0;scl=1;
  51   1        sda=bit4;scl=0;scl=1;
  52   1        sda=bit3;scl=0;scl=1;
  53   1        sda=bit2;scl=0;scl=1;
  54   1        sda=bit1;scl=0;scl=1;
C51 COMPILER V9.56.0.0   LCD                                                               10/25/2017 15:09:08 PAGE 2   

  55   1        sda=bit0;scl=0;scl=1;
  56   1        cs=1;      
  57   1      }
  58          
  59          void  write_data(uchar d)
  60          {
  61   1        cs=0;
  62   1        rs=1;
  63   1        bitdata=d;
  64   1        sda=bit7;scl=0;scl=1;
  65   1        sda=bit6;scl=0;scl=1;
  66   1        sda=bit5;scl=0;scl=1;
  67   1        sda=bit4;scl=0;scl=1;
  68   1        sda=bit3;scl=0;scl=1;
  69   1        sda=bit2;scl=0;scl=1;
  70   1        sda=bit1;scl=0;scl=1;
  71   1        sda=bit0;scl=0;scl=1;
  72   1        cs=1;
  73   1      }
  74          
  75          void wr_com16(unsigned char i,unsigned char j)    
  76          {         
  77   1        cs=0;
  78   1      
  79   1        rs=1;
  80   1        bitdata=i;
  81   1      
  82   1        sda=bit7;scl=0;scl=1;
  83   1        sda=bit6;scl=0;scl=1;
  84   1        sda=bit5;scl=0;scl=1;
  85   1        sda=bit4;scl=0;scl=1;
  86   1        sda=bit3;scl=0;scl=1;
  87   1        sda=bit2;scl=0;scl=1;
  88   1        sda=bit1;scl=0;scl=1;
  89   1        sda=bit0;scl=0;scl=1;
  90   1        cs=1;  
  91   1        cs=0;
  92   1      
  93   1      
  94   1        rs=1;
  95   1        bitdata=j;
  96   1      
  97   1        sda=bit7;scl=0;scl=1;
  98   1        sda=bit6;scl=0;scl=1;
  99   1        sda=bit5;scl=0;scl=1;
 100   1        sda=bit4;scl=0;scl=1;
 101   1        sda=bit3;scl=0;scl=1;
 102   1        sda=bit2;scl=0;scl=1;
 103   1        sda=bit1;scl=0;scl=1;
 104   1        sda=bit0;scl=0;scl=1;
 105   1        cs=1; 
 106   1       
 107   1      }
 108          //////////////////////////////////////////////////////////////////////////////////////////////
 109          
 110          void lcd_initial()
 111          {
 112   1      
 113   1          reset=0;
 114   1          delay(100);
 115   1          reset=1;
 116   1          delay(100);
C51 COMPILER V9.56.0.0   LCD                                                               10/25/2017 15:09:08 PAGE 3   

 117   1        
 118   1          //2.2inch TM2.2-G2.2 Init 20171020 
 119   1        write_command(0x11);  
 120   1        write_data(0x00); 
 121   1      
 122   1        write_command(0xCF);  
 123   1        write_data(0X00); 
 124   1        write_data(0XC1); 
 125   1        write_data(0X30);
 126   1      
 127   1        write_command(0xED);  
 128   1        write_data(0X64); 
 129   1        write_data(0X03); 
 130   1        write_data(0X12);
 131   1        write_data(0X81);
 132   1      
 133   1        write_command(0xE8);  
 134   1        write_data(0X85); 
 135   1        write_data(0X11); 
 136   1        write_data(0X78);
 137   1      
 138   1        write_command(0xF6);  
 139   1        write_data(0X01); 
 140   1        write_data(0X30); 
 141   1        write_data(0X00);
 142   1      
 143   1        write_command(0xCB);  
 144   1        write_data(0X39); 
 145   1        write_data(0X2C); 
 146   1        write_data(0X00);
 147   1        write_data(0X34);
 148   1        write_data(0X05);
 149   1      
 150   1        write_command(0xF7);  
 151   1        write_data(0X20); 
 152   1      
 153   1        write_command(0xEA);  
 154   1        write_data(0X00); 
 155   1        write_data(0X00); 
 156   1      
 157   1        write_command(0xC0);  
 158   1        write_data(0X20); 
 159   1      
 160   1        write_command(0xC1);  
 161   1        write_data(0X11); 
 162   1      
 163   1        write_command(0xC5);  
 164   1        write_data(0X31); 
 165   1        write_data(0X3C); 
 166   1      
 167   1        write_command(0xC7);  
 168   1        write_data(0XA9); 
 169   1      
 170   1        write_command(0x3A);  
 171   1        write_data(0X55); 
 172   1        
 173   1        write_command(0x36);  
 174   1        write_data(0x48);//竖屏参数 
 175   1      
 176   1        write_command(0xB1);  
 177   1        write_data(0X00); 
 178   1        write_data(0X18); 
C51 COMPILER V9.56.0.0   LCD                                                               10/25/2017 15:09:08 PAGE 4   

 179   1      
 180   1        write_command(0xB4);  
 181   1        write_data(0X00); 
 182   1        write_data(0X00); 
 183   1      
 184   1        write_command(0xF2);  
 185   1        write_data(0X00); 
 186   1      
 187   1        write_command(0x26);  
 188   1        write_data(0X01); 
 189   1      
 190   1        write_command(0xE0);  
 191   1        write_data(0X0F); 
 192   1        write_data(0X17); 
 193   1        write_data(0X14); 
 194   1        write_data(0X09); 
 195   1        write_data(0X0C); 
 196   1        write_data(0X06); 
 197   1        write_data(0X43); 
 198   1        write_data(0X75); 
 199   1        write_data(0X36); 
 200   1        write_data(0X08); 
 201   1        write_data(0X13); 
 202   1        write_data(0X05); 
 203   1        write_data(0X10); 
 204   1        write_data(0X0B); 
 205   1        write_data(0X08); 
 206   1      
 207   1      
 208   1        write_command(0xE1);  
 209   1        write_data(0X00); 
 210   1        write_data(0X1F); 
 211   1        write_data(0X23); 
 212   1        write_data(0X03); 
 213   1        write_data(0X0E); 
 214   1        write_data(0X04); 
 215   1        write_data(0X39); 
 216   1        write_data(0X25); 
 217   1        write_data(0X4D); 
 218   1        write_data(0X06); 
 219   1        write_data(0X0D); 
 220   1        write_data(0X0B); 
 221   1        write_data(0X33); 
 222   1        write_data(0X37); 
 223   1        write_data(0X0F); 
 224   1      
 225   1        write_command(0x29);    
 226   1      
 227   1      }
 228           void addset(unsigned int x,unsigned int y)
 229          {
 230   1          write_command(0x2a);
 231   1          wr_com16(x>>8,x);
 232   1          write_command(0x2b);
 233   1          wr_com16(y>>8,y);
 234   1          write_command(0x2c);
 235   1      }
 236          
 237          void dsp_single_colour(DH,DL)
 238          {
 239   1        unsigned int i,j;
 240   1        addset(0,0);
C51 COMPILER V9.56.0.0   LCD                                                               10/25/2017 15:09:08 PAGE 5   

 241   1        for (i=0;i<320;i++)
 242   1          for (j=0;j<240;j++)
 243   1              wr_com16(DH,DL);    
 244   1      
 245   1      }
 246          
 247          main()
 248          {
 249   1          lcd_initial();
 250   1            while(1)
 251   1          {
 252   2      
 253   2            Disp_gradscal(); //灰阶
*** WARNING C206 IN LINE 253 OF Program\Lcd.c: 'Disp_gradscal': missing function-prototype
 254   2            dsp_single_colour(0x84,0x10);//灰色
 255   2            dsp_single_colour(0xff,0xff);//白色
 256   2            dsp_single_colour(0x00,0x00);//黑色
 257   2            dsp_single_colour(0xf8,0x00);//红色
 258   2            dsp_single_colour(0x07,0xe0);//绿色
 259   2            dsp_single_colour(0x00,0x1f);//蓝色
 260   2      
 261   2          }
 262   1      
 263   1       }
 264          
 265          
 266          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    887    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      1       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
